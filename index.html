<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The River of Unwritten Destinies</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Inter:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&family=EB+Garamond:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <style>
        :root {
            --dawn-purple: #2c213d;
            --dawn-pink: #8b5f8a;
            --dawn-orange: #f8b195;
            --golden-glow: #FFD700;
            --dawn-reflection: rgba(255, 200, 150, 0.15);
            --fog-color: rgba(255, 220, 200, 0.1);
            --sun-color: #ff8c6b;
            --sun-glow-color: rgba(255, 140, 107, 0.6);
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--dawn-purple);
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .nav-panel,
        #navToggleIcon,
        #navToggleX {
            transition: all 0.3s ease-in-out;
        }

        #mainContent,
        .nav-panel {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        #mainContent::-webkit-scrollbar,
        .nav-panel::-webkit-scrollbar {
            display: none;
        }

        .festive-text {
            font-family: 'Gochi Hand', cursive;
        }

        h1,
        h2,
        h3 {
            font-family: 'Pacifico', cursive;
        }

        button {
            user-select: none;
        }

        #mainContent {
            position: absolute;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            height: -webkit-fill-available;
            overflow: hidden;
            background: linear-gradient(180deg, var(--dawn-purple) 0%, var(--dawn-pink) 70%);
            color: white;
            font-family: 'EB Garamond', 'Inter', serif;
            -webkit-tap-highlight-color: transparent;
            z-index: 1;
        }

        .river-background {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(180deg, #182848 0%, #0e1a35 100%);
            z-index: 1;
        }

        .scene {
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 2;
        }

        .sun {
            position: absolute;
            top: 15vh;
            left: 50%;
            transform: translateX(-50%);
            width: 15vw;
            height: 15vw;
            max-width: 120px;
            max-height: 120px;
            background: var(--sun-color);
            border-radius: 50%;
            box-shadow: 0 0 40px var(--sun-glow-color), 0 0 80px var(--sun-glow-color);
            animation: sun-pulse 8s ease-in-out infinite alternate;
            z-index: 0;
        }

        @keyframes sun-pulse {
            0% {
                transform: translateX(-50%) scale(1);
                opacity: 0.9;
            }

            100% {
                transform: translateX(-50%) scale(1.02);
                opacity: 1;
            }
        }

        .shimmer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(60deg,
                        rgba(255, 255, 255, 0.0) 0%,
                        rgba(255, 255, 255, 0.0) 45%,
                        rgba(255, 255, 255, 0.03) 50%,
                        rgba(255, 255, 255, 0.0) 55%,
                        rgba(255, 255, 255, 0.0) 100%);
            background-size: 150px 150px;
            opacity: 0.7;
            animation: shimmer 15s linear infinite;
            z-index: 3;
            pointer-events: none;
        }

        @keyframes shimmer {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 300px 300px;
            }
        }

        .moon-reflection {
            position: absolute;
            top: 25vh;
            left: 50%;
            width: 50vw;
            max-width: 400px;
            height: 15vh;
            background: var(--dawn-reflection);
            border-radius: 50%;
            filter: blur(20px);
            transform: translateX(-50%) rotateX(75deg);
            animation: pulse 10s ease-in-out infinite;
            z-index: 4;
            pointer-events: none;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.7;
                transform: translateX(-50%) rotateX(75deg) scale(1);
            }

            50% {
                opacity: 0.5;
                transform: translateX(-50%) rotateX(75deg) scale(0.98);
            }
        }

        .fog {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 25vh;
            background: linear-gradient(to top, var(--fog-color) 0%, transparent 100%);
            animation: drift 70s linear infinite;
            z-index: 6;
            pointer-events: none;
        }

        @keyframes drift {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 4px white, 0 0 8px white;
            animation: sparkle 12s linear infinite;
        }

        .particle:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: -1s;
        }

        .particle:nth-child(2) {
            top: 40%;
            left: 30%;
            animation-delay: -3s;
        }

        .particle:nth-child(3) {
            top: 60%;
            left: 20%;
            animation-delay: -5s;
        }

        .particle:nth-child(4) {
            top: 50%;
            left: 50%;
            animation-delay: -7s;
        }

        .particle:nth-child(5) {
            top: 70%;
            left: 70%;
            animation-delay: -2s;
        }

        .particle:nth-child(6) {
            top: 30%;
            left: 80%;
            animation-delay: -6s;
        }

        .particle:nth-child(7) {
            top: 80%;
            left: 90%;
            animation-delay: -8s;
        }

        .particle:nth-child(8) {
            top: 10%;
            left: 60%;
            animation-delay: -4s;
        }

        .particle:nth-child(9) {
            top: 85%;
            left: 40%;
            animation-delay: -10s;
        }

        .particle:nth-child(10) {
            top: 90%;
            left: 15%;
            animation-delay: -12s;
        }


        @keyframes sparkle {

            0%,
            100% {
                opacity: 0;
                transform: scale(0.5);
            }

            50% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .boat-container {
            position: absolute;
            left: 0;
            width: 100px;
            height: 80px;
            animation: glide-initial linear;
            z-index: 10;
            cursor: pointer;
        }

        .boat {
            width: 22vw;
            height: 22vw;
            max-width: 80px;
            max-height: 80px;
            position: absolute;
            bottom: 0;
            left: 0;
            cursor: pointer;

            background-image: url('data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cG9seWdvbiBwb2ludHM9IjEwLDgwIDUwLDIwIDkwLDgwIDUwLDgwIiBmaWxsPSJ3aGl0ZSIvPjxwb2x5Z29uIHBvaW50cz0iMTAsODAgOTAsODAgNzUsOTUgMjUsOTUiIGZpbGw9IiNmMGYwZjAiLz48L3N2Zz4=');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.7));
            animation: float 4s ease-in-out infinite;
            transition: transform 1s cubic-bezier(0.19, 1, 0.22, 1),
                filter 1s cubic-bezier(0.19, 1, 0.22, 1);
        }

        @keyframes glide-initial {
            0% {
                transform: translateX(-20vw);
            }

            100% {
                transform: translateX(110vw);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(3px);
            }
        }

        .boat.tapped {
            transform: translateY(-15px);
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1.2));
            animation-play-state: paused;
        }

        .ripple {
            position: absolute;
            border: 2px solid rgba(255, 215, 0, 0.7);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 1;
            animation: ripple-effect 1.5s ease-out;
            pointer-events: none;
            z-index: 9;
        }

        @keyframes ripple-effect {
            to {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
            }
        }

        .message {
            position: absolute;
            width: 70vw;
            max-width: 300px;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            animation: reveal 2s cubic-bezier(0.19, 1, 0.22, 1) forwards;

            left: 0;
            top: 0;

            font-family: 'EB Garamond', 'Inter', serif;
            font-style: italic;
            font-size: clamp(14px, 3.5vw, 16px);
            color: var(--golden-glow);
            text-shadow: 0 0 8px var(--golden-glow), 0 0 15px var(--golden-glow);
        }

        @keyframes reveal {
            0% {
                opacity: 0;
                transform: translate(-50%, 20px);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -15px);
            }
        }

        .message.hide {
            animation: hide 1.5s ease-in forwards;
        }

        @keyframes hide {
            0% {
                opacity: 1;
                transform: translate(-50%, -15px);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, 5px);
            }
        }
    </style>
</head>

<body class="antialiased overflow-hidden text-gray-800">

    <button id="navToggle" class="fixed top-6 left-6 p-2 bg-[var(--dawn-pink)] text-[var(--golden-glow)] rounded-full shadow-lg hover:bg-[var(--dawn-purple)] focus:outline-none focus:ring-2 focus:ring-[var(--dawn-pink)] focus:ring-offset-2" style="z-index: 70;">
        <svg id="navToggleIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-8 6h8"></path>
        </svg>
        <svg id="navToggleX" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    </button>
    
    <nav id="topNav" class="nav-panel fixed top-0 left-0 right-0 z-[60] h-16 bg-[var(--dawn-purple)] text-[var(--golden-glow)] shadow-md flex items-center justify-center space-x-6 -translate-y-full">
        <a href="index.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Home</a>
        <a href="Special.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Special</a>
        <a href="letter.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Letter</a>
    </nav>

    <nav id="bottomNav" class="nav-panel fixed bottom-0 left-0 right-0 z-[60] h-16 bg-[var(--dawn-purple)] text-[var(--golden-glow)] shadow-md flex items-center justify-center space-x-6 translate-y-full">
        <a href="anatomy.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Anatomy</a>
        <a href="chat.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Heaven</a>
        <a href="you.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">You</a>
    </nav>

    <nav id="leftNav" class="nav-panel fixed left-0 top-0 bottom-0 z-[60] w-20 bg-[var(--dawn-purple)] text-[var(--golden-glow)] shadow-md flex flex-col items-center space-y-6 -translate-x-full overflow-y-auto py-20">
        <a href="Diary.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Diary</a>
        <a href="Universe.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Universe</a>
        <a href="Box.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Box</a>
        <a href="color.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Color</a>
        <a href="Teacher.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Teacher</a>
        <a href="The_River.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">River</a>
        <a href="Mountain.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Mountain</a>
        <a href="Paper_Star.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Paper Star</a>
        <a href="Carttoon.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Cartoon</a>
        <a href="Santa.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Santa</a>
        <a href="Cloud.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Cloud</a>
        <a href="Ink.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Paint</a>
        <a href="Butterfly.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Butterfly</a>
        <a href="Weather.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Weather</a>
    </nav>

    <nav id="rightNav" class="nav-panel fixed right-0 top-0 bottom-0 z-[60] w-20 bg-[var(--dawn-purple)] text-[var(--golden-glow)] shadow-md flex flex-col items-center space-y-6 translate-x-full overflow-y-auto py-20">
        <a href="Skill.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Skill</a>
        <a href="Msg.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Massege</a>
        <a href="21_Wish.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">21_Door</a>
        <a href="Cake.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Cake</a>
        <a href="Periodik_table.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Periodik_table</a>
        <a href="Presence.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Presence</a>
        <a href="Concept.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Concept</a>
        <a href="Calender.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Calender</a>
        <a href="Perspective.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Perspective</a>
        <a href="Spotlight.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Spotlight</a>
        <a href="Room.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Room</a>
        <a href="Radio.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Radio</a>
        <a href="Food.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Food</a>
        <a href="Music.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-[var(--dawn-pink)] transition-colors duration-200 festive-text">Music</a>
    </nav>

    <div id="mainContent">
        <div class="river-background"></div>
        <div class="scene">

            <div class="sun"></div>
            <div class="shimmer"></div>
            <div class="moon-reflection"></div>
            
            <div class="particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>

            <div class="fog"></div>
            
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const navLinks = document.querySelectorAll('.nav-panel .nav-link');
            const mainContent = document.getElementById('mainContent');
            const topNav = document.getElementById('topNav');
            const bottomNav = document.getElementById('bottomNav');
            const leftNav = document.getElementById('leftNav');
            const rightNav = document.getElementById('rightNav');
            const navToggle = document.getElementById('navToggle');
            const navToggleIcon = document.getElementById('navToggleIcon');
            const navToggleX = document.getElementById('navToggleX');

            let areNavsOpen = false;

            function openAllNavs() {
                topNav.classList.remove('-translate-y-full');
                bottomNav.classList.remove('translate-y-full');
                leftNav.classList.remove('-translate-x-full');
                rightNav.classList.remove('translate-x-full');
                navToggleIcon.classList.add('hidden');
                navToggleX.classList.remove('hidden');
                areNavsOpen = true;
            }

            function closeAllNavs() {
                topNav.classList.add('-translate-y-full');
                bottomNav.classList.add('translate-y-full');
                leftNav.classList.add('-translate-x-full');
                rightNav.classList.add('translate-x-full');
                navToggleIcon.classList.remove('hidden');
                navToggleX.classList.add('hidden');
                areNavsOpen = false;
            }

            function toggleAllNavs() {
                if (areNavsOpen) {
                    closeAllNavs();
                } else {
                    openAllNavs();
                }
            }

            navToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleAllNavs();
            });

            mainContent.addEventListener('click', () => {
                if (areNavsOpen) {
                    closeAllNavs();
                }
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    const targetHref = e.currentTarget.getAttribute('href');
                    if (targetHref.startsWith('#')) {
                        e.preventDefault();
                    }
                    if (areNavsOpen) {
                        closeAllNavs();
                    }
                });
            });


            let audioStarted = false;
            let synth;

            const ALL_MESSAGES = [
                "You carried storms without letting anyone drown with you.",
                "Someone is quietly grateful you exist.",
                "Your dreams are already walking toward you.",
                "The world is softer because you are gentle.",
                "You are made of all the stories you've survived.",
                "Your kindness is a language everyone understands.",
                "You are not a burden. You are a universe.",
                "It's brave to be soft in a world that isn't.",
                "You are a rare and beautiful thing.",
                "Your light hasn't gone out. It's just resting.",
                "Someone finds peace in the thought of you.",
                "You are exactly who you need to be in this moment.",
                "Your capacity for love is your greatest strength.",
                "Even on your worst day, you are still trying.",
                "The seeds of your future are in the kindness you show today.",
                "You are more than your darkest moments.",
                "Your heart is a map to a thousand beautiful places.",
                "You are healing, even when it doesn't feel like it.",
                "The universe is conspiring to help you.",
                "Your quiet courage is louder than you think.",
                "You are a poem waiting to be read.",
                "Someone sees the magic in you. I hope you do too."
            ];
            let availableMessages = [...ALL_MESSAGES];

            const scene = document.querySelector('.scene');
            let activeMessageEl = null;

            function initAudio() {
                if (audioStarted) return;
                Tone.start();
                
                synth = new Tone.MembraneSynth({
                    pitchDecay: 0.01,
                    octaves: 2,
                    envelope: {
                        attack: 0.001,
                        decay: 0.3,
                        sustain: 0
                    }
                }).toDestination();
                synth.volume.value = -10;
                audioStarted = true;
            }

            function playRippleSound() {
                if (!audioStarted) initAudio();
                synth.triggerAttackRelease("C2", "8n", Tone.now());
            }

            function getUniqueMessage() {
                if (availableMessages.length === 0) {
                    availableMessages = [...ALL_MESSAGES];
                }
                const msgIndex = Math.floor(Math.random() * availableMessages.length);
                const msg = availableMessages.splice(msgIndex, 1)[0];
                return msg;
            }

            function createBoat() {
                const boatContainer = document.createElement('div');
                boatContainer.className = 'boat-container';

                const boatEl = document.createElement('div');
                boatEl.className = 'boat';

                boatEl.dataset.message = getUniqueMessage();

                
                const initialDuration = Math.random() * 20 + 50; 
                const topPos = Math.random() * 30 + 55; 
                boatContainer.style.animationDuration = initialDuration + 's';
                boatContainer.style.top = topPos + 'vh';
                
                
                function onTapped() {
                    if (boatEl.classList.contains('tapped')) return; 

                    
                    initAudio();
                    playRippleSound();

                    // --- FIX FOR MOBILE RELIABILITY: Forcefully remove any old message instantly ---
                    if (activeMessageEl) {
                        activeMessageEl.remove(); 
                        activeMessageEl = null; // Clear the state immediately
                    }
                    // ---------------------------------------------------------------------------------

                    
                    const ripple = document.createElement('div');
                    ripple.className = 'ripple';
                    document.body.appendChild(ripple);

                    const rect = boatEl.getBoundingClientRect();
                    ripple.style.top = (rect.top + rect.height / 2) + 'px';
                    ripple.style.left = (rect.left + rect.width / 2) + 'px';

                    ripple.onanimationend = () => {
                        ripple.remove();
                    };

                    
                    boatEl.classList.add('tapped');
                    boatEl.style.animationPlayState = 'paused'; 
                    boatContainer.style.animationPlayState = 'paused'; 

                    
                    const messageText = boatEl.dataset.message;
                    const messageEl = document.createElement('div');
                    messageEl.className = 'message';
                    messageEl.textContent = messageText;
                    activeMessageEl = messageEl; // Set the new message as active

                    const boatRect = rect;
                    let messageLeft = boatRect.left + (boatRect.width / 2);
                    const messageTop = boatRect.top - 10;

                    
                    const messageWidth = Math.min(window.innerWidth * 0.7, 300);
                    const halfMessageWidth = messageWidth / 2;
                    const padding = 10;
                    
                    if (messageLeft - halfMessageWidth < padding) {
                        messageLeft = halfMessageWidth + padding;
                    }
                    if (messageLeft + halfMessageWidth > window.innerWidth - padding) {
                        messageLeft = window.innerWidth - halfMessageWidth - padding;
                    }

                    messageEl.style.left = messageLeft + 'px';
                    messageEl.style.top = messageTop + 'px';

                    scene.appendChild(messageEl);

                    
                    setTimeout(() => {
                        messageEl.classList.add('hide');

                        // Clear the active state ONLY if this message is still the current one
                        if (messageEl === activeMessageEl) {
                             activeMessageEl = null;
                        }
                        
                        // Resume boat movement
                        boatEl.classList.remove('tapped');
                        boatEl.style.animationPlayState = 'running';
                        boatContainer.style.animationPlayState = 'running';

                        messageEl.onanimationend = () => {
                            messageEl.remove();
                        };
                    }, 4500);
                }

                
                boatContainer.addEventListener('click', onTapped);
                
                
                boatContainer.addEventListener('touchstart', (e) => {
                    e.preventDefault(); 
                    onTapped();
                }, { passive: false });

                
                boatContainer.addEventListener('animationend', () => {
                    boatContainer.remove();
                });

                boatContainer.appendChild(boatEl);
                scene.appendChild(boatContainer);
            }

            
            setInterval(createBoat, 3000);

            
            createBoat();
            
            
            document.body.addEventListener('click', initAudio, { once: true });
        });
    </script>

</body>

</html>
