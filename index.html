<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Presence</title>

<script src="https://cdn.tailwindcss.com"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Inter:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

<style>
  :root{
    --c1: #8a2be2;
    --c2: #00c8ff;
    --c3: #ff4b9e;
    --bg1:#fdfcff;
    --bg2:#f5f4f7;
    --gold-1:#D8B765;
    --gold-2:#E7C987;
    --char:#222;
    --nav-pink:#FF69B4;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    background: radial-gradient(1200px 800px at 50% 60%, var(--bg2), var(--bg1));
    overflow:hidden;
    font-family:"Merriweather","Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#334;
  }

  /* background blobs */
  #bg{ position:fixed; inset:0; z-index:1; overflow:hidden; pointer-events:none; }
  .blob{ position:absolute; width:52vmin; height:52vmin; border-radius:50%; filter: blur(70px) saturate(130%); opacity:.65; mix-blend-mode:multiply; will-change: transform; }
  .b1{ background: radial-gradient(circle at 30% 30%, var(--c1), transparent 65%); left:-10vmin; top:-8vmin; animation:floatA 22s ease-in-out infinite alternate; }
  .b2{ background: radial-gradient(circle at 60% 40%, var(--c2), transparent 65%); right:-12vmin; top:10vmin; animation:floatB 18s ease-in-out infinite alternate-reverse; }
  .b3{ background: radial-gradient(circle at 50% 60%, var(--c3), transparent 65%); left:15vmin; bottom:-12vmin; animation:floatC 26s ease-in-out infinite alternate; }
  @keyframes floatA {0%{transform:translate(-10%,-6%) scale(1)}50%{transform:translate(5%,-12%) scale(1.18)}100%{transform:translate(-8%,8%) scale(.96)}}
  @keyframes floatB {0%{transform:translate(10%,8%) scale(1.05)}50%{transform:translate(-4%,-6%) scale(1.22)}100%{transform:translate(8%,12%) scale(.92)}}
  @keyframes floatC {0%{transform:translate(0%,0%) scale(.95)}50%{transform:translate(8%,10%) scale(1.12)}100%{transform:translate(-6%,-8%) scale(1)}}

  /* slides */
  .slide{ position:fixed; inset:0; z-index:3; display:flex; flex-direction:column; align-items:center; justify-content:center; padding: clamp(16px,4vw,32px); text-align:center; opacity:0; transform:translateY(24px) scale(.995); transition: opacity .6s ease, transform .6s ease; pointer-events:none; }
  .slide.active{ opacity:1; transform:translateY(0) scale(1); pointer-events:auto; }

  .title{ font-weight:700; font-size: clamp(22px,5vw,38px); letter-spacing:.2px; text-shadow:0 0 12px rgba(0,0,0,.12); font-family:'Merriweather',serif; }
  .title .letter{ display:inline-block; transform:translateY(30px); opacity:0; transition: all .7s cubic-bezier(.175,.885,.32,1.275); transition-delay: var(--delay); }
  .slide.active .title .letter{ transform:translateY(0); opacity:1; }

  /* analog area under title - clock always visible here */
  .analog-wrap{ margin-top:10px; display:flex; align-items:center; justify-content:center; height:140px; }
  .shared-clock{ width:126px; height:126px; display:block; }
  @media (max-width:380px){ .shared-clock{ width:98px; height:98px } }

  /* IMPORTANT: for SVG where hands live inside a translated group, origin is 0 0 */
  .hand {
    transform-origin: 0px 0px;
  }
  .hand-hour, .hand-minute { transition: transform 1400ms cubic-bezier(.22,.9,.18,1); will-change: transform; }
  .hand-second { transition: transform 900ms cubic-bezier(.22,.9,.18,1), opacity 250ms; will-change: transform; }
  .hand-second.hidden{ opacity:0; }

  .description{ font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; font-size: clamp(13px,1.8vw,16px); line-height:1.6; margin-top:14px; max-width:700px; color:#667; white-space: pre-line; opacity:0; transform:translateY(20px); transition: opacity .7s ease .6s, transform .7s ease .6s; }
  .slide.active .description{ opacity:1; transform:translateY(0); }

  .actions{ position: fixed; left:0; right:0; bottom: clamp(12px,3.5vh,30px); z-index:4; display:flex; justify-content:center; pointer-events:none; }
  .btn{ pointer-events:auto; padding:10px 26px; border-radius:999px; cursor:pointer; font-size:16px; backdrop-filter: blur(10px); box-shadow: 0 8px 24px rgba(0,0,0,.08); background: rgba(255,255,255,0.6); border:1px solid rgba(0,0,0,0.06); }
  .btn:hover{ transform: translateY(-2px); }

  #fade{ position:fixed; inset:0; z-index:5; background: rgba(255,255,255,.5); opacity:0; pointer-events:none; transition: opacity .35s ease; }

  /* NAV */
  .nav-panel{ position: fixed; z-index:60; color:#fff; background:var(--nav-pink); box-shadow:0 10px 30px rgba(0,0,0,.15); transition: transform 320ms cubic-bezier(.22,.9,.18,1); -webkit-overflow-scrolling: touch; }
  #navTop{ left:0; right:0; top:0; height:64px; transform: translateY(-120%); display:flex; align-items:center; justify-content:center; gap:18px; }
  #navBottom{ left:0; right:0; bottom:0; height:64px; transform: translateY(120%); display:flex; align-items:center; justify-content:center; gap:18px; }
  #navLeft{ top:0; bottom:0; left:0; width:84px; transform: translateX(-120%); display:flex; flex-direction:column; align-items:center; padding-top:80px; gap:14px; overflow:auto; }
  #navRight{ top:0; bottom:0; right:0; width:84px; transform: translateX(120%); display:flex; flex-direction:column; align-items:center; padding-top:80px; gap:14px; overflow:auto; }

  .nav-link{ padding:8px 12px; border-radius:10px; font-weight:600; color:#fff; text-decoration:none; font-size:14px; }
  .nav-link:hover{ background: rgba(0,0,0,0.08); }

  .open-top{ transform: translateY(0) !important; }
  .open-bottom{ transform: translateY(0) !important; }
  .open-left{ transform: translateX(0) !important; }
  .open-right{ transform: translateX(0) !important; }

  #navToggle{ position: fixed; z-index:70; left:14px; top:14px; width:44px; height:44px; border-radius:999px; background:var(--nav-pink); color:white; display:flex; align-items:center; justify-content:center; box-shadow:0 8px 20px rgba(0,0,0,0.12); border:none; cursor:pointer; }
  #navToggle:active{ transform:scale(.98); }

  #navDim{ position: fixed; inset:0; z-index:59; background: rgba(0,0,0,0.25); opacity:0; pointer-events:none; transition: opacity 220ms; }
  #navDim.visible{ opacity:1; pointer-events:auto; }

  .center-dot{ filter: drop-shadow(0 2px 2px rgba(0,0,0,0.12)); }

  @media (max-width:420px){ #navLeft,#navRight{ width:68px } }
</style>
</head>
<body class="antialiased text-gray-800">

<div id="bg">
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
</div>

<canvas id="particle-canvas"></canvas>

<!-- audio (autoplay as requested) -->
<audio id="bgAudio" src="bgm.mp3" preload="auto" autoplay playsinline></audio>

<!-- nav dim -->
<div id="navDim" aria-hidden="true"></div>

<!-- nav panels -->
<nav id="navTop" class="nav-panel" aria-label="Top navigation">
  <a class="nav-link" href="index.html">Home</a>
  <a class="nav-link" href="Special.html">Special</a>
  <a class="nav-link" href="letter.html">Letter</a>
</nav>

<nav id="navBottom" class="nav-panel" aria-label="Bottom navigation">
  <a class="nav-link" href="anatomy.html">Anatomy</a>
  <a class="nav-link" href="chat.html">Heaven</a>
  <a class="nav-link" href="you.html">You</a>
</nav>

<nav id="navLeft" class="nav-panel" aria-label="Left navigation">
  <a class="nav-link" href="Diary.html">Diary</a>
  <a class="nav-link" href="Universe.html">Universe</a>
  <a class="nav-link" href="Box.html">Box</a>
  <a class="nav-link" href="color.html">Color</a>
  <a class="nav-link" href="Teacher.html">Teacher</a>
  <a class="nav-link" href="The_River.html">River</a>
  <a class="nav-link" href="Mountain.html">Mountain</a>
  <a class="nav-link" href="Paper_Star.html">Paper Star</a>
  <a class="nav-link" href="Carttoon.html">Cartoon</a>
  <a class="nav-link" href="Santa.html">Santa</a>
  <a class="nav-link" href="Cloud.html">Cloud</a>
  <a class="nav-link" href="Ink.html">Paint</a>
  <a class="nav-link" href="Butterfly.html">Butterfly</a>
  <a class="nav-link" href="Weather.html">Weather</a>
</nav>

<nav id="navRight" class="nav-panel" aria-label="Right navigation">
  <a class="nav-link" href="Skill.html">Skill</a>
  <a class="nav-link" href="Msg.html">Message</a>
  <a class="nav-link" href="21_Wish.html">21_Door</a>
  <a class="nav-link" href="Cake.html">Cake</a>
  <a class="nav-link" href="Periodik_table.html">Periodic Table</a>
  <a class="nav-link" href="Presence.html">Presence</a>
  <a class="nav-link" href="Concept.html">Concept</a>
  <a class="nav-link" href="Calender.html">Calendar</a>
  <a class="nav-link" href="Perspective.html">Perspective</a>
  <a class="nav-link" href="Spotlight.html">Spotlight</a>
  <a class="nav-link" href="Room.html">Room</a>
  <a class="nav-link" href="Radio.html">Radio</a>
  <a class="nav-link" href="Food.html">Food</a>
  <a class="nav-link" href="Music.html">Music</a>
</nav>

<!-- nav toggle -->
<button id="navToggle" aria-label="Open navigation">
  <svg id="navIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M4 6h16M4 12h16M4 18h16"></path>
  </svg>
  <svg id="navCloseIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none">
    <path d="M6 18L18 6M6 6l12 12"></path>
  </svg>
</button>

<!-- SHARED GOLDEN CLOCK SVG (generated new) -->
<div id="sharedClockTemplate" style="display:none">
  <svg class="shared-clock" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Analog clock">
    <defs>
      <radialGradient id="g1" cx="50%" cy="40%">
        <stop offset="0%" stop-color="#fff8e6"/>
        <stop offset="45%" stop-color="#E7C987"/>
        <stop offset="100%" stop-color="#D8B765"/>
      </radialGradient>
    </defs>

    <!-- outer ring -->
    <circle cx="60" cy="60" r="56" fill="url(#g1)" stroke="#b58f40" stroke-width="2"/>
    <!-- face -->
    <circle cx="60" cy="60" r="50" fill="#fafafa" stroke="rgba(0,0,0,0.03)" stroke-width="1"/>

    <!-- ticks (12) -->
    <g transform="translate(60,60)" stroke="rgba(0,0,0,0.14)" stroke-width="1.6">
      <g><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(30)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(60)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(90)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(120)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(150)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(180)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(210)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(240)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(270)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(300)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
      <g transform="rotate(330)"><line x1="0" y1="-42" x2="0" y2="-50" stroke="#8a6b2d" stroke-width="2.4"/></g>
    </g>

    <!-- hands group with precise center at 60,60 -->
    <g id="hands" transform="translate(60,60)">
      <!-- hour hand (short, thick) -->
      <g id="hourHand" class="hand hand-hour" style="transform: rotate(0deg);">
        <rect x="-2" y="-32" width="4" height="32" rx="2" fill="#2b2b2b"></rect>
      </g>
      <!-- minute hand (longer) -->
      <g id="minuteHand" class="hand hand-minute" style="transform: rotate(0deg);">
        <rect x="-1.5" y="-45" width="3" height="45" rx="1.5" fill="#2b2b2b"></rect>
      </g>
      <!-- second hand (thin) -->
      <g id="secondHand" class="hand hand-second" style="transform: rotate(0deg);">
        <rect x="-1" y="-52" width="2" height="52" rx="1" fill="#b33"></rect>
      </g>
      <circle cx="0" cy="0" r="3.2" fill="var(--gold-1)" stroke="#b58f40" stroke-width="0.6" class="center-dot"/>
    </g>
  </svg>
</div>

<!-- slides -->
<div id="slide-container" style="position:absolute; inset:0; z-index:3;">

  <section class="slide active" data-theme="0">
    <h1 class="title">The Quiet Hour</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">ğŸŒ… 1 hour to come

The place waits quietly for you â€” still calm, still normal, but already aware
that something soft and bright is on the way.
Even the air feels like it's warming up in advance. ğŸŒ¤ï¸âœ¨</p>
  </section>

  <section class="slide" data-theme="1">
    <h1 class="title">The Half-Hour Glow</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â³ 30 minutes to come

A little excitement starts spreading in the corners.

Lights look brighter, shadows behave better,
and the whole place seems to whisper,
â€œSheâ€™ll be here soonâ€¦ look alive.â€ ğŸ˜ŒğŸŒ¸</p>
  </section>

  <section class="slide" data-theme="2">
    <h1 class="title">The Soft Fifteen</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">âŒ› 15 minutes to come

The silence softens itself,
the wind slows down as if practising a gentle welcome,
and everything prepares for the kind of peace
that only your presence brings. ğŸŒ¬ï¸ğŸ’—</p>
  </section>

  <section class="slide" data-theme="3">
    <h1 class="title">The Final Five</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â± 5 minutes to come

The surroundings straighten up,
colors adjust themselves like theyâ€™re fixing their makeup,
and the moment starts glowing quietly â€”
because youâ€™re almost here. ğŸŒ¼ğŸ’«</p>
  </section>

  <section class="slide" data-theme="4">
    <h1 class="title">The Shy Minute</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â° 1 minute to come

Time becomes shy.
The air pauses.
Even the smallest details wait politely,
as if the whole place is holding its breath
just to welcome you right. ğŸŒ™ğŸ¤</p>
  </section>

  <section class="slide" data-theme="5">
    <h1 class="title">The Last Ten Seconds</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">ğŸ‘£ 10 seconds to come (seeing you from a distance)

Everything slips into natural slow-motion.
The world brightens one shade higher,
the breeze aligns with your footsteps,
and your presence starts colouring the place
even before you reach it. âœ¨ğŸŒ·</p>
  </section>

  <section class="slide" data-theme="6">
    <h1 class="title">Arrival</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">ğŸ¤ While meeting

When you arrive, the atmosphere shifts instantly â€”
warm, calm, gently glowing.
Chairs, sunlight, even the background air
start behaving extra nicely,
as if trying to match your energy. ğŸŒğŸ’

A small smile from you feels like
the whole place gets better lighting.
A tiny laugh from you feels like
the day itself becomes lighter. ğŸ’ğŸ˜„</p>
  </section>

  <section class="slide" data-theme="7">
    <h1 class="title">The Gentle Goodbye</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â³ 10 seconds after you leave

The place goes strangely quiet â€”
like it suddenly remembers it has nothing smart left to say.
The air still holds a hint of your warmth,
as if youâ€™re just one breath away. ğŸŒ«ï¸ğŸ’—</p>
  </section>

  <section class="slide" data-theme="8">
    <h1 class="title">One Minute After</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â³ 1 minute after you leave

The surroundings try to return to normalâ€¦
but fail adorably.
The light looks confused,
the breeze slows down like itâ€™s still expecting you to turn back. ğŸŒ¥ï¸âœ¨</p>
  </section>

  <section class="slide" data-theme="9">
    <h1 class="title">Fifteen Minutes After</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â³ 15 minutes after you leave

A gentle dullness settles in.
The colors dim a little,
as if your brightness was borrowed
and now the place doesnâ€™t know what to do without it. ğŸŒ™ğŸŒ¸</p>
  </section>

  <section class="slide" data-theme="10">
    <h1 class="title">Thirty Minutes After</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â³ 30 minutes after you leave

Everything finally goes back to its routine,
but the atmosphere keeps a quiet softness â€”
a leftover trace of your presence
that refuses to fade quickly. ğŸƒğŸ¤</p>
  </section>

  <section class="slide" data-theme="11">
    <h1 class="title">One Hour After</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">â³ 1 hour after you leave

The world is completely normal againâ€¦
but the place still remembers you
the way a window remembers sunlight
long after the sun has moved on. ğŸŒ¦ï¸ğŸ’</p>
  </section>

  <section class="slide" data-theme="12">
    <h1 class="title">Happy Birthday</h1>
    <div class="analog-wrap" aria-hidden="true"></div>
    <p class="description">ğŸ‚ Happy Birthday

Youâ€™re not just a person passing through a place â€”
youâ€™re the reason the place feels sweeter,
softer, warmer, calmer,
and a little more alive. âœ¨ğŸ’–
Happy Birthday â€” may your day glow like your presence. ğŸ‰ğŸŒ¸</p>
  </section>

</div>

<div class="actions">
  <button class="btn" id="nextBtn">Next â†’</button>
</div>

<div id="fade"></div>

<script>
/* --- slides & times --- */
const slides = [...document.querySelectorAll('.slide')];
const nextBtn = document.getElementById('nextBtn');
const fade = document.getElementById('fade');
let currentIndex = 0;

// times with seconds when needed; last is birthday
const slideTimes = [
  {h:16,m:0,s:0, showSeconds:false},    // 4:00
  {h:16,m:30,s:0, showSeconds:false},   // 4:30
  {h:16,m:45,s:0, showSeconds:false},   // 4:45
  {h:16,m:55,s:0, showSeconds:false},   // 4:55
  {h:16,m:59,s:0, showSeconds:false},   // 4:59
  {h:16,m:59,s:50, showSeconds:true},   // 4:59:50
  {h:17,m:0,s:0, showSeconds:false},    // 5:00
  {h:23,m:0,s:10, showSeconds:true},    // 11:00:10
  {h:23,m:1,s:0, showSeconds:false},    // 11:01
  {h:23,m:15,s:0, showSeconds:false},   // 11:15
  {h:23,m:30,s:0, showSeconds:false},   // 11:30
  {h:0,m:0,s:0, showSeconds:false},     // 12:00
  {h:0,m:0,s:0, showSeconds:false}      // Birthday (final)
];

/* --- build shared clock from template --- */
const template = document.getElementById('sharedClockTemplate');
const sharedClock = template.firstElementChild.cloneNode(true);
template.remove();

const hourHand = sharedClock.querySelector('#hourHand');
const minuteHand = sharedClock.querySelector('#minuteHand');
const secondHand = sharedClock.querySelector('#secondHand');

// absolute angles (to always rotate forward)
let absHourAngle = null;
let absMinuteAngle = null;
let absSecondAngle = null;

// attach the shared clock under the slide title and keep moving it to the active slide
function attachClock(index){
  const wrap = slides[index].querySelector('.analog-wrap');
  wrap.innerHTML = '';
  wrap.appendChild(sharedClock);
  sharedClock.style.opacity = '1';
  sharedClock.setAttribute('aria-hidden','false');
}

/* helpers to compute normalized angles (0..360) */
function timeToAngles(t){
  const hour12 = t.h % 12;
  const hourAngle = (hour12 * 30) + (t.m * 0.5) + (t.s * (0.5/60)); // deg
  const minuteAngle = (t.m * 6) + (t.s * 0.1);
  const secondAngle = t.s * 6;
  return {h: hourAngle, m: minuteAngle, s: secondAngle};
}

/* ensure forward rotation target - fixed version */
function computeForwardTarget(currentAbs, targetNorm){
  // if no previous absolute angle, return target (first time)
  if (currentAbs === null) return targetNorm;

  // normalize current absolute to [0,360)
  const curNorm = ((currentAbs % 360) + 360) % 360;

  // small difference considered equal -> no rotation
  let delta = targetNorm - curNorm;
  if (Math.abs(delta) < 1e-9) {
    // already exactly at target; keep absolute angle as-is
    return currentAbs;
  }

  // we want a forward-only rotation: if negative add 360
  if (delta < 0) delta += 360;

  return currentAbs + delta;
}

/* easing */
function easeInOutCubic(t){ return t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2; }

/* animate hands to target normalized angles (duration ms) */
function animateHandsTo(targetNorms, duration=1400, showSeconds=false){
  // compute absolute targets that are >= currentAbs (forward)
  const targetHourAbs = computeForwardTarget(absHourAngle, targetNorms.h);
  const targetMinuteAbs = computeForwardTarget(absMinuteAngle, targetNorms.m);
  const targetSecondAbs = computeForwardTarget(absSecondAngle, targetNorms.s);

  const startHour = (absHourAngle === null) ? targetHourAbs : absHourAngle;
  const startMinute = (absMinuteAngle === null) ? targetMinuteAbs : absMinuteAngle;
  const startSecond = (absSecondAngle === null) ? targetSecondAbs : absSecondAngle;

  const t0 = performance.now();

  if(showSeconds) secondHand.classList.remove('hidden');

  return new Promise(resolve=>{
    function step(now){
      const p = Math.min(1, (now - t0) / duration);
      const eased = easeInOutCubic(p);

      const curH = startHour + (targetHourAbs - startHour) * eased;
      const curM = startMinute + (targetMinuteAbs - startMinute) * eased;
      const curS = startSecond + (targetSecondAbs - startSecond) * eased;

      // apply transforms (use style.transform to avoid attribute conflicts)
      hourHand.style.transform = `rotate(${curH}deg)`;
      minuteHand.style.transform = `rotate(${curM}deg)`;
      secondHand.style.transform = `rotate(${curS}deg)`;

      if(p < 1) requestAnimationFrame(step);
      else {
        absHourAngle = targetHourAbs;
        absMinuteAngle = targetMinuteAbs;
        absSecondAngle = targetSecondAbs;

        if(!showSeconds) secondHand.classList.add('hidden'); else secondHand.classList.remove('hidden');

        resolve();
      }
    }
    requestAnimationFrame(step);
  });
}

/* initial attach + initialize angles to first slide (4:00) */
attachClock(0);

// compute initial normalized angles for slide 0
const initNorm = timeToAngles(slideTimes[0]);

// set absolute angles to the normalized values (first absolute == normalized)
absHourAngle = initNorm.h;
absMinuteAngle = initNorm.m;
absSecondAngle = initNorm.s;

// apply transforms after DOM paint to ensure CSS transform origin works correctly
requestAnimationFrame(() => {
  hourHand.style.transform = `rotate(${absHourAngle}deg)`;
  minuteHand.style.transform = `rotate(${absMinuteAngle}deg)`;
  secondHand.style.transform = `rotate(${absSecondAngle}deg)`;

  if (!slideTimes[0].showSeconds) secondHand.classList.add('hidden');
  else secondHand.classList.remove('hidden');
});

/* theme palettes */
function applyTheme(idx){
  const palettes = [
    ['#8a2be2','#00c8ff','#ff4b9e'],
    ['#ff7ad9','#7ad9ff','#ffd36e'],
    ['#7c7bff','#54ffd9','#ff7a9e'],
    ['#64a8ff','#b57aff','#ff8f66'],
    ['#78ffd6','#7aa2ff','#ff66c4'],
    ['#a47bff','#66ffe2','#ffbd6e'],
    ['#6ee7ff','#b380ff','#ff6ea6'],
    ['#ffb6c1','#89f7fe','#ffd1dc'],
    ['#ffc3a0','#b8f2e6','#f6b6ff'],
    ['#c1ffd7','#b3d4ff','#ffb3d2'],
    ['#d7c1ff','#bff6e0','#ffd9b3'],
    ['#bfe7ff','#d3b7ff','#ffb7da'],
    ['#8a2be2','#00c8ff','#ff4b9e'],
  ];
  const p = palettes[idx] || palettes[0];
  document.documentElement.style.setProperty('--c1', p[0]);
  document.documentElement.style.setProperty('--c2', p[1]);
  document.documentElement.style.setProperty('--c3', p[2]);
}

/* show slide */
async function showSlide(index){
  if(index < 0 || index >= slides.length) return;
  slides[currentIndex].classList.remove('active');
  currentIndex = index;
  const s = slides[currentIndex];
  s.classList.add('active');

  // move clock under new slide title (keeps clock always visible under active heading)
  attachClock(currentIndex);

  // compute target
  const t = slideTimes[currentIndex];
  const norms = timeToAngles(t);
  await animateHandsTo(norms, 1400, !!t.showSeconds);
  applyTheme(currentIndex);
}

/* Next button */
let isAnimating = false;
nextBtn.addEventListener('click', async ()=>{
  if(isAnimating) return;
  isAnimating = true;
  startAudioIfNeeded();
  fade.style.opacity = 1;
  await new Promise(r=>setTimeout(r,220));
  const nextIndex = (currentIndex === slides.length - 1) ? 0 : currentIndex + 1;
  await showSlide(nextIndex);
  setTimeout(()=>{ fade.style.opacity = 0; isAnimating = false; }, 200);
});

/* keyboard/swipe */
window.addEventListener('keydown', e=>{
  if(['ArrowRight','Enter',' '].includes(e.key)){ e.preventDefault(); nextBtn.click(); }
  if(e.key==='ArrowLeft'){ e.preventDefault(); const prev = (currentIndex === 0)? slides.length - 1 : currentIndex - 1; if(isAnimating) return; isAnimating=true; fade.style.opacity=1; setTimeout(()=>{ showSlide(prev); fade.style.opacity=0; isAnimating=false; },280); }
});
let touchX = null;
window.addEventListener('touchstart', e=>{ touchX = e.touches[0].clientX; startAudioIfNeeded(); }, {passive:true});
window.addEventListener('touchend', e=>{ if(touchX==null) return; const dx = e.changedTouches[0].clientX - touchX; if(dx < -40) nextBtn.click(); if(dx > 40){ const prev = (currentIndex === 0)? slides.length - 1 : currentIndex - 1; if(isAnimating) return; isAnimating=true; fade.style.opacity=1; setTimeout(()=>{ showSlide(prev); fade.style.opacity=0; isAnimating=false; },280); } touchX = null; });

/* title letter animation + initial theme */
document.addEventListener('DOMContentLoaded', ()=>{
  document.querySelectorAll('.title').forEach(title => {
    title.innerHTML = title.textContent.split('').map((c,idx)=>`<span class="letter" style="--delay:${idx*28}ms">${c===' ' ? '&nbsp;' : c}</span>`).join('');
  });
  applyTheme(0);
});

/* --- audio fade-in on first load attempt --- */
const audioEl = document.getElementById('bgAudio'); audioEl.loop = false;
function tryPlayAudioOnLoad(){
  // attempt to play (some browsers block autoplay; user interaction will always work)
  const p = audioEl.play();
  if (p && typeof p.then === 'function') {
    p.catch(()=>{ /* autoplay blocked - will start on interaction */ });
  }
}
window.addEventListener('load', ()=>{ tryPlayAudioOnLoad(); });

let audioStarted = false, webAudioGain = null;
function initWebAudioGain(){ try{ const AudioContext = window.AudioContext || window.webkitAudioContext; if(!AudioContext) return null; const ac = new AudioContext(); const src = ac.createMediaElementSource(audioEl); const g = ac.createGain(); g.gain.value = 0; src.connect(g).connect(ac.destination); return {ac,g}; }catch(e){return null;} }
function fadeInAudio(){ const TARGET=0.35, DURATION=1800; if(webAudioGain){ const now = webAudioGain.ac.currentTime; webAudioGain.gain.gain.cancelScheduledValues(now); webAudioGain.gain.gain.setValueAtTime(0, now); webAudioGain.gain.gain.linearRampToValueAtTime(TARGET, now + DURATION/1000); } else { audioEl.volume = 0; const steps=20; let step=0; const t = setInterval(()=>{ step++; audioEl.volume = Math.min(TARGET, (TARGET * step/steps)); if(step>=steps) clearInterval(t); }, DURATION/steps); } }
function startAudioIfNeeded(){ if(audioStarted) return; audioStarted=true; webAudioGain = initWebAudioGain(); const p = audioEl.play(); if(p && typeof p.then === 'function'){ p.then(()=>fadeInAudio()).catch(()=>fadeInAudio()); } else fadeInAudio(); }

/* --- particles --- */
const canvas = document.getElementById('particle-canvas'); const ctx = canvas.getContext('2d'); let particles = [], canvasW, canvasH, lastParticleTime=0; const particleThrottle=30;
function resizeCanvas(){ canvasW = canvas.width = window.innerWidth; canvasH = canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas, {passive:true}); resizeCanvas();
function getThemeColor(){ const s = getComputedStyle(document.documentElement); const arr = [s.getPropertyValue('--c1').trim(), s.getPropertyValue('--c2').trim(), s.getPropertyValue('--c3').trim()]; return arr[Math.floor(Math.random()*arr.length)]; }
function createParticle(e){ const now = Date.now(); if(now - lastParticleTime < particleThrottle) return; lastParticleTime = now; let x = e.clientX || (e.touches && e.touches[0] && e.touches[0].clientX) || canvasW/2; let y = e.clientY || (e.touches && e.touches[0] && e.touches[0].clientY) || canvasH/2; const count=2; if(particles.length>200) particles.splice(0,Math.floor(particles.length*0.1)); for(let i=0;i<count;i++){ particles.push({x,y,color:getThemeColor(),size:Math.random()*4+2,vx:Math.random()*2-1,vy:Math.random()*2-1,life:Math.random()*50+50}); } }
window.addEventListener('mousemove', createParticle, {passive:true}); window.addEventListener('touchmove', createParticle, {passive:true});
function particleLoop(){ ctx.fillStyle='rgba(245,244,247,0.25)'; ctx.fillRect(0,0,canvasW,canvasH); for(let i=particles.length-1;i>=0;i--){ const p = particles[i]; p.x+=p.vx; p.y+=p.vy; p.life--; p.size*=0.98; if(p.life>0 && p.size>0.5){ ctx.beginPath(); ctx.fillStyle = p.color; ctx.globalAlpha = Math.max(0, p.life/75); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1; } else particles.splice(i,1); } requestAnimationFrame(particleLoop); }
particleLoop();

/* --- Navigation open/close (all at once) --- */
const navToggle = document.getElementById('navToggle');
const navTop = document.getElementById('navTop');
const navBottom = document.getElementById('navBottom');
const navLeft = document.getElementById('navLeft');
const navRight = document.getElementById('navRight');
const navDim = document.getElementById('navDim');
const navIcon = document.getElementById('navIcon');
const navCloseIcon = document.getElementById('navCloseIcon');
let navOpen = false;
function openAllNavs(){ navTop.classList.add('open-top'); navBottom.classList.add('open-bottom'); navLeft.classList.add('open-left'); navRight.classList.add('open-right'); navDim.classList.add('visible'); navIcon.style.display='none'; navCloseIcon.style.display='block'; navOpen=true; }
function closeAllNavs(){ navTop.classList.remove('open-top'); navBottom.classList.remove('open-bottom'); navLeft.classList.remove('open-left'); navRight.classList.remove('open-right'); navDim.classList.remove('visible'); navIcon.style.display='block'; navCloseIcon.style.display='none'; navOpen=false; }
navToggle.addEventListener('click', (e)=>{ e.stopPropagation(); startAudioIfNeeded(); if(navOpen) closeAllNavs(); else openAllNavs(); });
navDim.addEventListener('click', closeAllNavs);
document.querySelectorAll('.nav-panel .nav-link').forEach(a=>a.addEventListener('click', ()=>setTimeout(closeAllNavs,120)));
[navTop,navBottom,navLeft,navRight].forEach(p=>{ p.addEventListener('click', e=>e.stopPropagation()); p.addEventListener('touchstart', e=>e.stopPropagation(), {passive:true}); });

</script>
</body>
</html>
